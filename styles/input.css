@import "tailwindcss";
@plugin "@tailwindcss/typography";

@theme {
  --font-sans: "Inter", ui-sans-serif, system-ui, sans-serif;
  --font-serif: "Lora", "Georgia", serif;
  --font-mono: "Roboto Mono", ui-monospace, monospace;

  --max-width-reading: 70ch;
  --max-width-content: 75rem;
}

@custom-variant dark (&:where(.dark, .dark *));

/* Base: readable text and selection */
@layer base {
  html {
    @apply scroll-smooth text-[15px] sm:text-[16px];
  }
  body {
    @apply antialiased min-h-screen flex flex-col;
  }
  ::selection {
    @apply bg-teal-200 dark:bg-teal-800/80 text-slate-900 dark:text-slate-100;
  }
}

/* Prose and links */
a {
  @apply text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300 hover:underline transition-colors duration-150;
}
.prose a {
  @apply text-teal-600 hover:text-teal-700 dark:text-teal-400 dark:hover:text-teal-300 hover:underline;
}

/* Code blocks: light/dark via .dark class (class-based dark mode) */
pre {
  @apply p-4 rounded-xl overflow-x-auto border border-slate-200 dark:border-slate-600;
}
pre,
.prose pre {
  background-color: var(--color-slate-100);
  color: var(--color-slate-900);
  font-family: var(--font-mono);
  font-size: 0.875em;
  line-height: 1.6;
}
:where(.dark) pre,
:where(.dark) .prose pre {
  background-color: var(--color-slate-800);
  color: var(--color-slate-100);
  border-color: var(--color-slate-700);
}

.prose code {
  @apply font-mono text-[0.9em] font-medium;
}

/* Book content: optimal reading width when no sidebar (e.g. narrow viewports) */
.prose {
  @apply max-w-reading font-serif text-slate-900 dark:text-slate-100;
  line-height: 1.75;
}
.prose.max-w-none {
  max-width: none;
}

/* Sidebar scrollbar (webkit) */
.overflow-y-auto {
  scrollbar-width: thin;
  scrollbar-color: var(--color-slate-300) transparent;
}
:where(.dark) .overflow-y-auto {
  scrollbar-color: var(--color-slate-600) transparent;
}
.overflow-y-auto::-webkit-scrollbar {
  width: 6px;
}
.overflow-y-auto::-webkit-scrollbar-track {
  background: transparent;
}
.overflow-y-auto::-webkit-scrollbar-thumb {
  @apply bg-slate-300 dark:bg-slate-600 rounded-full;
}
.overflow-y-auto::-webkit-scrollbar-thumb:hover {
  @apply bg-slate-400 dark:bg-slate-500;
}

/* Safe area for notched devices */
.safe-area-padding {
  padding-left: env(safe-area-inset-left, 0);
  padding-right: env(safe-area-inset-right, 0);
}

/* Custom Typography overrides */
.prose {
  --tw-prose-body: inherit;
  --tw-prose-headings: var(--color-slate-900);
  --tw-prose-links: var(--color-teal-600);
  --tw-prose-bold: inherit;
  --tw-prose-counters: var(--color-slate-500);
  --tw-prose-bullets: var(--color-slate-300);
  --tw-prose-hr: var(--color-slate-200);
  --tw-prose-quotes: var(--color-slate-900);
  --tw-prose-quote-borders: var(--color-slate-200);
  --tw-prose-captions: var(--color-slate-500);
  --tw-prose-code: var(--color-slate-900);
  --tw-prose-pre-code: var(--color-slate-100);
  --tw-prose-pre-bg: var(--color-slate-800);
  --tw-prose-th-borders: var(--color-slate-300);
  --tw-prose-td-borders: var(--color-slate-200);
  
  --tw-prose-invert-body: inherit;
  --tw-prose-invert-headings: var(--color-white);
  --tw-prose-invert-links: var(--color-teal-400);
  --tw-prose-invert-bold: inherit;
  --tw-prose-invert-counters: var(--color-slate-400);
  --tw-prose-invert-bullets: var(--color-slate-600);
  --tw-prose-invert-hr: var(--color-slate-700);
  --tw-prose-invert-quotes: var(--color-slate-100);
  --tw-prose-invert-quote-borders: var(--color-slate-700);
  --tw-prose-invert-captions: var(--color-slate-400);
  --tw-prose-invert-code: var(--color-white);
  --tw-prose-invert-pre-code: var(--color-slate-300);
  --tw-prose-invert-pre-bg: rgb(0 0 0 / 50%);
  --tw-prose-invert-th-borders: var(--color-slate-600);
  --tw-prose-invert-td-borders: var(--color-slate-700);
}

.prose h1, .prose h2, .prose h3, .prose h4 {
  @apply font-semibold tracking-tight text-slate-900 dark:text-white;
  font-family: var(--font-serif);
}

.prose p {
  @apply leading-relaxed mb-6;
}

/* Nav links */
.nav-link { 
  @apply text-teal-600 dark:text-teal-400 hover:text-teal-800 dark:hover:text-teal-300 no-underline transition-colors duration-150; 
}
.nav-link-disabled { 
  @apply text-slate-400 dark:text-slate-600 cursor-not-allowed; 
}

/* TOC Styles */
.toc-container .toc { @apply p-0 m-0 bg-transparent shadow-none rounded-none my-0; }
.toc-container .toc > ul { @apply list-none p-0 m-0 border-none; }
.toc-container .toc > ul > li { @apply mb-1; }
.toc-container .toc > ul > li > a {
    @apply text-slate-600 dark:text-slate-300 hover:text-teal-500 dark:hover:text-teal-400 text-sm font-medium;
    @apply transition-all duration-150 block py-3 rounded-md px-3 no-underline;
}
.toc-container .toc > ul > li > a:hover {
    @apply bg-slate-100 dark:bg-slate-700 translate-x-[2px];
}
.toc-container .toc > ul > li > ul { @apply list-none pl-3 mt-1 border-l border-slate-200 dark:border-slate-700 ml-2; }
.toc-container .toc > ul > li > ul > li { @apply mb-0.5; }
.toc-container .toc > ul > li > ul > li > a {
    @apply text-slate-600 dark:text-slate-400 hover:text-teal-600 dark:hover:text-teal-400 text-xs;
    @apply transition-all duration-150 block py-2 px-3 rounded-md no-underline;
}
.toc-container .toc > ul > li > ul > li > a:hover {
    @apply bg-slate-100 dark:bg-slate-700 translate-x-[2px];
}
.toc-container .toc a.active {
    @apply text-white! dark:text-white font-semibold bg-teal-600 dark:bg-teal-700 translate-x-[4px];
}
.toc-container .toc > ul > li > details > summary {
    @apply text-slate-600 dark:text-slate-400 hover:text-teal-600 dark:hover:text-teal-400 text-sm font-medium;
    @apply transition-all duration-150 block py-3 rounded-md px-3 cursor-pointer list-none no-underline;
}
.toc-container .toc > ul > li > details > summary::-webkit-details-marker {
    @apply hidden;
}
.toc-container .toc > ul > li > details > summary:hover {
    @apply bg-slate-100 dark:bg-slate-700 translate-x-[2px];
}
.toc-container .toc > ul > li > details[open] > summary {
    @apply text-teal-600 dark:text-teal-400;
}

/* Mobile Toggles and Panels */
body.overflow-hidden-important { @apply overflow-hidden; }

#scrollToTopBtn.visible {
    @apply opacity-100 translate-y-0 pointer-events-auto;
}

@media (max-width: 1023px) {
    #mobile-toc-panel {
        @apply fixed top-0 left-0 z-[70];
        height: 100vh;
    }
}
